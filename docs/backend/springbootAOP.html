<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Spring Boot 中 AOP的使用 | Lrvinye</title><meta data-react-helmet="true" property="og:url" content="http://blog.lrvinye.cn/docs/backend/springbootAOP"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Spring Boot 中 AOP的使用 | Lrvinye"><meta data-react-helmet="true" name="description" content="AOP 面向切面编程 与传统的OOP相比，为我们提供了更加强大的功能"><meta data-react-helmet="true" property="og:description" content="AOP 面向切面编程 与传统的OOP相比，为我们提供了更加强大的功能"><link data-react-helmet="true" rel="shortcut icon" href="https://cdn.lrvinye.cn/logo/cherryez/favicon-nobg.ico"><link data-react-helmet="true" rel="canonical" href="http://blog.lrvinye.cn/docs/backend/springbootAOP"><link data-react-helmet="true" rel="alternate" href="http://blog.lrvinye.cn/docs/backend/springbootAOP" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://blog.lrvinye.cn/docs/backend/springbootAOP" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.783fb10b.css">
<link rel="preload" href="/assets/js/runtime~main.54c95e00.js" as="script">
<link rel="preload" href="/assets/js/main.802ed988.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/favicon.ico" alt="lrvinye" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/favicon.ico" alt="lrvinye" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Lrvinye&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docs/devops/index">👩‍💻运维</a><a class="navbar__item navbar__link" href="/docs/backend/index">🚀后端</a><a class="navbar__item navbar__link" href="/docs/frontend/index">💻前端</a><a class="navbar__item navbar__link" href="/docs/middleware/index">🔗中间件</a><a class="navbar__item navbar__link" href="/docs/solution/index">🔍解决方案</a><a class="navbar__item navbar__link" href="/docs/memo/index">📝记录</a><a class="navbar__item navbar__link" href="/docs/flight/index">🛫飞行</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/about">关于我</a><a href="https://github.com/lrvinye/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/backend/index">后端造火箭</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/backend/prepareTypescriptNodejsServerAutoDev">准备Typescript开发Nodejs服务端自动化开发</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/backend/springbootAOP">Spring Boot 中 AOP的使用</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Spring Boot 中 AOP的使用</h1></header><p><strong>AOP 面向切面编程</strong> 与传统的<strong>OOP</strong>相比，为我们提供了更加强大的功能</p><p>在<code>Spring</code>大家族中spring的AOP是spring的两大功能模块之一，提供了优秀的解耦解决方案。</p><p><em>在springboot中，可以很方便的使用spring提供的aop切面</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="注入依赖"></a>注入依赖<a class="hash-link" href="#注入依赖" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-aop</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="通过注解标识创建切面类"></a>通过注解标识创建切面类<a class="hash-link" href="#通过注解标识创建切面类" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@Aspect //把当前类标识为一个切面供容器读取</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component //注入spring</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class XXXAspect {...}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="标识切面pointcut的切入点"></a>标识切面<code>PointCut</code>的切入点<a class="hash-link" href="#标识切面pointcut的切入点" title="Direct link to heading">#</a></h2><p>可通过多种函数进行匹配切点</p><ul><li><strong>execution切点函数</strong></li></ul><p>匹配方法执行的连接点，语法为：</p><p>execution(方法修饰符(可选)  返回类型  方法名  参数  异常模式(可选)) </p><p>参数部分允许使用通配符：</p><p>*  匹配任意字符，但只能匹配一个元素</p><p>.. 匹配任意字符，可以匹配任意多个元素，表示类时，必须和*联合使用</p><p>+  必须跟在类名后面，如Horseman+，表示类本身和继承或扩展指定类的所有类</p><p><code>ex:</code> </p><p><code>execution(public * com.example.controller.*.*(..))</code> </p><p>表示所有<code>com.example.controller</code>包下面的<strong>所有</strong>类的所有<strong>公共</strong>方法</p><p><code>execution(private * com.example.controller.User*.*(..))</code></p><p>表示所有<code>com.example.controller</code>包下面的<strong>以<code>User</code>开头的</strong>类的所有<strong>私有</strong>方法</p><p><code>execution(protected * com.example.controller.*V1.*(..))</code></p><p>表示所有<code>com.example.controller</code>包下面的<strong>以<code>V1</code>结尾的</strong>类的所有<strong>包保护</strong>方法</p><ul><li><strong>@annotation()</strong></li></ul><p>标注了指定注解的目标类<strong>方法</strong></p><p>如：</p><p> <code>@annotation(org.springframework.transaction.annotation.Transactional)</code> 表示标注了<code>@Transactional</code>的方法</p><p><code>execution</code>常用于匹配特定的方法，或者匹配某些类，如所有的controller类，</p><p>是一种范围较大的切面方式，多用于日志或者事务处理等。</p><ul><li><strong>args()</strong></li></ul><p>通过 目标类方法的参数类型 指定切点</p><p>如 <code>args(String)</code> 表示有且仅有一个<code>String</code>型参数的方法</p><ul><li><strong>@args()</strong></li></ul><p>通过 目标类<strong>参数</strong>的对象类型 是否标注了 指定注解指定切点</p><p>如 <code>@args(org.springframework.stereotype.Service)</code> 表示有且仅有一个标注了@Service的类参数的方法</p><ul><li><strong>within()</strong></li></ul><p>通过 类名 指定切点</p><p>如 <code>with(examples.model.Man)</code> 表示Man类的所有方法</p><ul><li><strong>@within()</strong></li></ul><p>匹配 标注了指定注解的类 及其<strong>所有</strong>子类</p><p>如 <code>@within(org.springframework.stereotype.Service)</code> 给Man加上@Service标注，</p><p>则Man和Woman的所有方法都匹配</p><ul><li><strong>target()</strong></li></ul><p>通过 类名 指定，同时包含<strong>所有</strong>子类</p><p>如 <code>target(examples.model.Man) </code> 并且 <code>Woman extends Man</code>，则两个类的所有方法都匹配</p><ul><li><strong>@target()</strong></li></ul><p>所有标注了指定注解的<strong>类</strong></p><p>如 <code>@target(org.springframework.stereotype.Service) </code>表示所有标注了@Service的类下面的所有方法</p><ul><li><strong>this()</strong></li></ul><p>与<code>target()</code>的区别是<code>this</code>是在运行时生成代理类后，才判断代理类与指定的对象类型是否匹配</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="逻辑运算符"></a><strong>逻辑运算符</strong><a class="hash-link" href="#逻辑运算符" title="Direct link to heading">#</a></h3><p>上面提到的函数表达式都可由多个切点函数通过逻辑运算组成</p><ul><li><strong>&amp;&amp;</strong></li></ul><p>可以写成and</p><ul><li><strong>||</strong></li></ul><p>可以写成or</p><ul><li><strong>!</strong></li></ul><p>可以写成not</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="切面方法使用"></a>切面方法使用<a class="hash-link" href="#切面方法使用" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly md"><pre tabindex="0" class="prism-code language-md codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@Before</span></span><span class="token-line" style="color:#393A34"><span class="token plain">标识一个前置增强方法，相当于BeforeAdvice的功能</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    用于在切点前执行一些操作</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@AfterReturning</span></span><span class="token-line" style="color:#393A34"><span class="token plain">后置增强，相当于AfterReturningAdvice，方法退出时且有返回值时(没有抛出异常)执行</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    可以通过@AfterReturning(returning = “XXX”)，获取controller里方法的返回值(XXX)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@AfterThrowing</span></span><span class="token-line" style="color:#393A34"><span class="token plain">异常抛出增强，相当于ThrowsAdvice</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    可以通过@AfterThrowing(throwing = &quot;XXX&quot;)获得抛出的异常(XXX)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@After</span></span><span class="token-line" style="color:#393A34"><span class="token plain">final增强，不管是抛出异常或者正常退出都会执行</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">除了@Around外，每个方法里都可以加或者不加参数JoinPoint，</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important">JoinPoint里包含了类名、被切面的方法名，参数等属性，可供读取使用</span></span><span class="token-line" style="color:#393A34"><span class="token title important"></span><span class="token title important punctuation" style="color:#393A34">================================================================================</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Around</span></span><span class="token-line" style="color:#393A34"><span class="token plain">环绕增强，相当于MethodInterceptor</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    在这个方法里面,必须带有参数 </span><span class="token code keyword" style="color:#00009f">`ProceedingJoinPoint`</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    使用 ProceedingJoinPoint.proceed 的前后就相当于@Before与@After</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    执行 ProceedingJoinPoint.proceed 相当于调用执行了切点方法</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    该方法的返回值为 Object 即为切点方法执行的返回值</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="切面中方法执行顺序"></a>切面中方法执行顺序<a class="hash-link" href="#切面中方法执行顺序" title="Direct link to heading">#</a></h3><ol><li>@Around中 ProceedingJoinPoint.proceed 执行前</li><li>@Before</li><li>@Around中 ProceedingJoinPoint.proceed 执行后</li><li>@After</li><li>@AfterReturning (无异常) 或 @AfterThrowing (有异常被抛出)</li></ol><p><strong>如果有多个切面同时作用：</strong></p><p>进入范围大的 → 进入范围小的 → 离开范围小的 → 离开范围大的</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/backend/springbootAOP.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/backend/prepareTypescriptNodejsServerAutoDev"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 准备Typescript开发Nodejs服务端自动化开发</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#注入依赖" class="table-of-contents__link">注入依赖</a></li><li><a href="#通过注解标识创建切面类" class="table-of-contents__link">通过注解标识创建切面类</a></li><li><a href="#标识切面pointcut的切入点" class="table-of-contents__link">标识切面<code>PointCut</code>的切入点</a><ul><li><a href="#逻辑运算符" class="table-of-contents__link"><strong>逻辑运算符</strong></a></li></ul></li><li><a href="#切面方法使用" class="table-of-contents__link">切面方法使用</a><ul><li><a href="#切面中方法执行顺序" class="table-of-contents__link">切面中方法执行顺序</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Useful Links</div><ul class="footer__items"><li class="footer__item"><a href="https://cherryez.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cherryez<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://sparkye.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>火花科技<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://ibootcloud.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>iBootCloud<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/lrvinye" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/xi-da-43-53" target="_blank" rel="noopener noreferrer" class="footer__link-item">ZhiHu 知乎</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Lrvinye, CN. Built with <a src="docusaurus.io">Docusaurus</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.54c95e00.js"></script>
<script src="/assets/js/main.802ed988.js"></script>
</body>
</html>